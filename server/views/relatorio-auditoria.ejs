<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RelatÃ³rio de Auditoria - Agrovale</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="sidebar">
    <h2>Agrovale</h2>
    <ul>
      <li><a href="/dashboard">ğŸ  InÃ­cio</a></li>
      <li><a href="/produtos">ğŸ“¦ Produtos</a></li>
      <li><a href="/vendas">ğŸ’° Vendas</a></li>
      <li><a href="/estatisticas">ğŸ“Š EstatÃ­sticas</a></li>
      <li><a href="/clientes">ğŸ‘¤ Clientes</a></li>
      <li><a href="/relatorios/auditoria">ğŸ§¾ Auditoria</a></li>
      <li><a href="/logout">ğŸšª Sair</a></li>
    </ul>
  </div>

  <div class="content">
    <header><h1>Agrovale â€” Painel Administrativo</h1></header>

    <div class="banner">
      âš ï¸ Apenas administradores tÃªm acesso a este relatÃ³rio.
    </div>

    <form class="filters" method="GET" action="/relatorios/auditoria">
      <div>
        <label for="usuario">UsuÃ¡rio:</label><br>
        <input type="text" name="usuario" id="usuario" value="<%= filtroUsuario || '' %>">
      </div>
      <div>
        <label for="acao">AÃ§Ã£o:</label><br>
        <select name="acao" id="acao">
          <option value="">Todas</option>

          <!-- ğŸ§¾ Clientes -->
          <option value="Cadastro de Cliente" <%= filtroAcao === 'Cadastro de Cliente' ? 'selected' : '' %>>Cadastro de Cliente</option>
          <option value="AlteraÃ§Ã£o de Cliente" <%= filtroAcao === 'AlteraÃ§Ã£o de Cliente' ? 'selected' : '' %>>AlteraÃ§Ã£o de Cliente</option>
          <option value="InativaÃ§Ã£o de Cliente" <%= filtroAcao === 'InativaÃ§Ã£o de Cliente' ? 'selected' : '' %>>InativaÃ§Ã£o de Cliente</option>
          <option value="ReativaÃ§Ã£o de Cliente" <%= filtroAcao === 'ReativaÃ§Ã£o de Cliente' ? 'selected' : '' %>>ReativaÃ§Ã£o de Cliente</option>

          <!-- ğŸ“¦ Produtos -->
          <option value="Cadastro de Produto" <%= filtroAcao === 'Cadastro de Produto' ? 'selected' : '' %>>Cadastro de Produto</option>
          <option value="AtualizaÃ§Ã£o de Produto" <%= filtroAcao === 'AtualizaÃ§Ã£o de Produto' ? 'selected' : '' %>>AtualizaÃ§Ã£o de Produto</option>
          <option value="ExclusÃ£o de Produto" <%= filtroAcao === 'ExclusÃ£o de Produto' ? 'selected' : '' %>>ExclusÃ£o de Produto</option>
          <option value="Entrada de Mercadoria" <%= filtroAcao === 'Entrada de Mercadoria' ? 'selected' : '' %>>Entrada de Mercadoria</option>

          <!-- ğŸ’° Vendas -->
          <option value="Cadastro de Venda" <%= filtroAcao === 'Cadastro de Venda' ? 'selected' : '' %>>Cadastro de Venda</option>
          <option value="AtualizaÃ§Ã£o de Venda" <%= filtroAcao === 'AtualizaÃ§Ã£o de Venda' ? 'selected' : '' %>>AtualizaÃ§Ã£o de Venda</option>
          <option value="ExclusÃ£o de Venda" <%= filtroAcao === 'ExclusÃ£o de Venda' ? 'selected' : '' %>>ExclusÃ£o de Venda</option>

          <!-- ğŸ‘¥ UsuÃ¡rios -->
          <option value="Cadastro de UsuÃ¡rio" <%= filtroAcao === 'Cadastro de UsuÃ¡rio' ? 'selected' : '' %>>Cadastro de UsuÃ¡rio</option>
          <option value="AlteraÃ§Ã£o de UsuÃ¡rio" <%= filtroAcao === 'AlteraÃ§Ã£o de UsuÃ¡rio' ? 'selected' : '' %>>AlteraÃ§Ã£o de UsuÃ¡rio</option>
          <option value="InativaÃ§Ã£o de UsuÃ¡rio" <%= filtroAcao === 'InativaÃ§Ã£o de UsuÃ¡rio' ? 'selected' : '' %>>InativaÃ§Ã£o de UsuÃ¡rio</option>
          <option value="ReativaÃ§Ã£o de UsuÃ¡rio" <%= filtroAcao === 'ReativaÃ§Ã£o de UsuÃ¡rio' ? 'selected' : '' %>>ReativaÃ§Ã£o de UsuÃ¡rio</option>
        </select>
      </div>
      <div>
        <label for="dataInicio">De:</label><br>
        <input type="date" name="dataInicio" id="dataInicio" value="<%= filtroInicio || '' %>">
      </div>
      <div>
        <label for="dataFim">AtÃ©:</label><br>
        <input type="date" name="dataFim" id="dataFim" value="<%= filtroFim || '' %>">
      </div>
      <div style="align-self: end;">
        <button type="submit" class="btn btn-primary">Filtrar</button>
      </div>
    </form>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>UsuÃ¡rio</th>
          <th>AÃ§Ã£o</th>
          <th>Tabela Afetada</th>
          <th>Registro ID</th>
          <th>DescriÃ§Ã£o</th>
          <th>Data / Hora</th>
        </tr>
      </thead>
      <tbody>
        <% if (logs.length === 0) { %>
          <tr><td colspan="7" class="text-center">Nenhum registro encontrado.</td></tr>
        <% } else { %>
          <% logs.forEach(log => { %>
            <tr>
              <td><%= log.LogID %></td>
              <td><%= log.Usuario %></td>
              <td><%= log.Acao %></td>
              <td><%= log.TabelaAfetada %></td>
              <td><%= log.RegistroID %></td>
              <td><%= log.Descricao %></td>
              <td><%= new Date(log.DataHora).toLocaleString('pt-BR') %></td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>
  </div>
</body>
</html>
